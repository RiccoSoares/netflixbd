DROP TABLE IF EXISTS REGIAO CASCADE;
DROP TABLE IF EXISTS CONTA CASCADE;
DROP TABLE IF EXISTS PERFIL CASCADE;
DROP TABLE IF EXISTS GENERO CASCADE;
DROP TABLE IF EXISTS PERFIL_PREFERE CASCADE;
DROP TABLE IF EXISTS DIRETOR CASCADE;
DROP TABLE IF EXISTS ATOR CASCADE;
DROP TABLE IF EXISTS CONTEUDO CASCADE;
DROP TABLE IF EXISTS AUDIO CASCADE;
DROP TABLE IF EXISTS LEGENDA CASCADE;
DROP TABLE IF EXISTS AUDIO_LEGENDA CASCADE;
DROP TABLE IF EXISTS SERIES CASCADE;
DROP TABLE IF EXISTS TEMPORADAS CASCADE;
DROP TABLE IF EXISTS EPISODIOS CASCADE;
DROP TABLE IF EXISTS LEGENDA_AUDIO_EPISODIOS CASCADE;
DROP TABLE IF EXISTS FILMES CASCADE;
DROP TABLE IF EXISTS LEGENDA_AUDIO_FILMES CASCADE;
DROP TABLE IF EXISTS LISTA_PERFIL CASCADE;
DROP TABLE IF EXISTS MOTIVO_RECOMENDACAO CASCADE;
DROP TABLE IF EXISTS RECOMENDACOES_PERFIL CASCADE;
DROP TABLE IF EXISTS DISPONIVEL_PARA CASCADE;
DROP TABLE IF EXISTS ESTRELANDO CASCADE;
DROP TABLE IF EXISTS DO_GENERO CASCADE;
DROP TABLE IF EXISTS DIRIGIDO_POR CASCADE;
DROP TABLE IF EXISTS ASSISTIR CASCADE;

CREATE TABLE REGIAO
	(nome VARCHAR(200) NOT NULL,
PRIMARY KEY(nome));
 
CREATE TABLE  CONTA
	(email VARCHAR(254) NOT NULL,
	plano NUMERIC(3) NOT NULL,
	telasonline NUMERIC(1) NOT NULL,
	cpf NUMERIC(11) NOT NULL UNIQUE,
	cartao_titular VARCHAR(26) NOT NULL,
	cartao_numero NUMERIC(19) NOT NULL,
	cartao_cvv NUMERIC(4) NOT NULL,
	cartao_val DATE NOT NULL,
	senha VARCHAR(64) NOT NULL,
PRIMARY KEY (email));

CREATE TABLE PERFIL
	(email_conta VARCHAR(254) NOT NULL,
	nome VARCHAR(50) NOT NULL,
	imagem VARCHAR(255) NOT NULL, --endereco do arquivo de imagem
	regiao VARCHAR(20),
PRIMARY KEY(email_conta, nome),
FOREIGN KEY(email_conta) REFERENCES CONTA(email) ON DELETE CASCADE,
FOREIGN KEY(regiao) REFERENCES REGIAO(nome) ON DELETE SET NULL);

CREATE TABLE GENERO
	(nome VARCHAR(30) NOT NULL,
PRIMARY KEY(nome));

CREATE TABLE PERFIL_PREFERE --preferencia do usuario por generos
	(email_perfil VARCHAR(254) NOT NULL,
	nome_perfil VARCHAR(50) NOT NULL,
	nome_genero VARCHAR(30) NOT NULL,
	ordem NUMERIC(3) NOT NULL,
PRIMARY KEY(email_perfil, nome_perfil, nome_genero),
FOREIGN KEY(email_perfil, nome_perfil) REFERENCES PERFIL(email_conta, nome) ON DELETE CASCADE,
FOREIGN KEY(nome_genero) REFERENCES GENERO(nome) ON DELETE CASCADE);
 
CREATE TABLE DIRETOR
	(nome VARCHAR(150) NOT NULL,
PRIMARY KEY (nome));

CREATE TABLE ATOR
	(nome VARCHAR(150) NOT NULL,
PRIMARY KEY (nome));

CREATE TABLE CONTEUDO
	(id VARCHAR(30) NOT NULL,
	nome VARCHAR(150) NOT NULL,
	ano NUMERIC(4) NOT NULL,
	sinopse VARCHAR(400) NOT NULL,
	poster VARCHAR(255) NOT NULL UNIQUE,
	ci NUMERIC(2) NOT NULL,
	visu INT NOT NULL,
	original BOOLEAN NOT NULL,
PRIMARY KEY (id));

CREATE TABLE AUDIO_LEGENDA --tabela contendo arquivos de audio ou de legenda no banco de dados
	(arquivo VARCHAR(255) NOT NULL UNIQUE, --caminho do arquivo
	idioma VARCHAR(30) NOT NULL,
	descricao VARCHAR(10) NOT NULL, --tipicacamente 'audio' ou 'legenda'
PRIMARY KEY(arquivo, descricao));

CREATE TABLE FILMES
	(id_conteudo VARCHAR(30) NOT NULL,
	arquivo VARCHAR(255) NOT NULL,
PRIMARY KEY(id_conteudo));

CREATE TABLE LEGENDA_AUDIO_FILMES --tabela que contem as opcoes de audio e legenda para os filmes
	(id_filme VARCHAR(30) NOT NULL,
	nome_arquivo VARCHAR(255) NOT NULL UNIQUE,
PRIMARY KEY(id_filme, nome_arquivo),
FOREIGN KEY(id_filme) REFERENCES FILMES(id_conteudo) ON DELETE CASCADE,
FOREIGN KEY(nome_arquivo) REFERENCES AUDIO_LEGENDA(arquivo) ON DELETE SET NULL); 

CREATE TABLE SERIES
	(id_conteudo VARCHAR(30) NOT NULL,
	arquivo VARCHAR(255) NOT NULL,
PRIMARY KEY(id_conteudo));

CREATE TABLE TEMPORADAS
	(id_serie VARCHAR(30) NOT NULL,
	numero NUMERIC(2) NOT NULL UNIQUE,
PRIMARY KEY(id_serie, numero),
FOREIGN KEY(id_serie) REFERENCES SERIES(id_conteudo) ON DELETE CASCADE);

CREATE TABLE EPISODIOS
	(id_temporada VARCHAR(30) NOT NULL,
	numero_temporada NUMERIC(2) NOT NULL,
	numero NUMERIC(2) NOT NULL UNIQUE,
	sinopse VARCHAR(400) NOT NULL,
	thumbnail VARCHAR(280) NOT NULL,
	nome VARCHAR(100),
	arquivo VARCHAR(255) NOT NULL,	
PRIMARY KEY(id_temporada, numero_temporada, numero),
FOREIGN KEY(id_temporada, numero_temporada) REFERENCES TEMPORADAS(id_serie, numero) ON DELETE CASCADE);

CREATE TABLE LEGENDA_AUDIO_EPISODIOS --tabela que contem as opceos de audio e legenda para os episodios de series
	(id_temporada VARCHAR(30) NOT NULL,
	numero_temporada NUMERIC(2) NOT NULL,
	numero_episodio NUMERIC(2) NOT NULL,
	nome_arquivo VARCHAR(255) NOT NULL UNIQUE,
PRIMARY KEY(id_temporada, numero_temporada, numero_episodio, nome_arquivo),
FOREIGN KEY(id_temporada, numero_temporada, numero_episodio) REFERENCES EPISODIOS(id_temporada, numero_temporada, numero) ON DELETE CASCADE,
FOREIGN KEY(nome_arquivo) REFERENCES AUDIO_LEGENDA(arquivo) ON DELETE CASCADE);

CREATE TABLE LISTA_PERFIL --lista de conteudos ("para ver depois") de um perfil
	(email_perfil VARCHAR(254) NOT NULL,
	nome_perfil VARCHAR(50) NOT NULL,
	id_conteudo VARCHAR(30) NOT NULL,
PRIMARY KEY(email_perfil, nome_perfil, id_conteudo),
FOREIGN KEY(email_perfil, nome_perfil) REFERENCES PERFIL(email_conta, nome) ON DELETE CASCADE,
FOREIGN KEY(id_conteudo) REFERENCES CONTEUDO(id) ON DELETE CASCADE);

CREATE TABLE MOTIVO_RECOMENDACAO --tabela de motivos pre-especificados pelos quais um conteudo pode ser recomendado a um usuario
	(motivo VARCHAR(50) NOT NULL,
PRIMARY KEY(motivo));

CREATE TABLE RECOMENDACOES_PERFIL --tabela de conteudos recomendados especificamente para um perifl
	(email_perfil VARCHAR(254) NOT NULL,
	nome_perfil VARCHAR(50) NOT NULL,
	id_conteudo VARCHAR(30) NOT NULL,
	motivo VARCHAR(30) NOT NULL,
PRIMARY KEY(email_perfil, nome_perfil, id_conteudo),
FOREIGN KEY(email_perfil, nome_perfil) REFERENCES PERFIL(email_conta, nome) ON DELETE CASCADE,
FOREIGN KEY(motivo) REFERENCES MOTIVO_RECOMENDACAO(motivo) ON DELETE CASCADE);
	
CREATE TABLE DISPONIVEL_PARA --disponibilidade de obra em regioes
	(conteudo_id VARCHAR(30) NOT NULL,
	regiao_nome VARCHAR(200) NOT NULL,
PRIMARY KEY(conteudo_id, regiao_nome),
FOREIGN KEY(conteudo_id) REFERENCES CONTEUDO(id) ON DELETE CASCADE,
FOREIGN KEY(regiao_nome) REFERENCES REGIAO(nome) ON DELETE CASCADE);

CREATE TABLE ESTRELANDO --atores presentes em obra
	(conteudo_id VARCHAR(30) NOT NULL,
	ator_nome VARCHAR(150) NOT NULL,
PRIMARY KEY(conteudo_id, ator_nome),
FOREIGN KEY(conteudo_id) REFERENCES CONTEUDO(id) ON DELETE CASCADE,
FOREIGN KEY(ator_nome) REFERENCES ATOR(nome) ON DELETE CASCADE);

CREATE TABLE DO_GENERO --generos da obra
	(conteudo_id VARCHAR(30) NOT NULL,
	genero_nome VARCHAR(30) NOT NULL,
PRIMARY KEY(conteudo_id, genero_nome),
FOREIGN KEY(conteudo_id) REFERENCES CONTEUDO(id) ON DELETE CASCADE,
FOREIGN KEY (genero_nome) REFERENCES GENERO(nome) ON DELETE CASCADE);

CREATE TABLE DIRIGIDO_POR --diretores da obra
	(conteudo_id VARCHAR(30) NOT NULL,
	nome_diretor VARCHAR(150) NOT NULL,
PRIMARY KEY(conteudo_id, nome_diretor),
FOREIGN KEY(conteudo_id) REFERENCES CONTEUDO(id) ON DELETE CASCADE,
FOREIGN KEY(nome_diretor) REFERENCES DIRETOR(nome) ON DELETE CASCADE);
	
CREATE TABLE ASSISTIR 
	(email_conta VARCHAR(254) NOT NULL,
	perfil	VARCHAR(50) NOT NULL,
	conteudo_id VARCHAR(30) NOT NULL,
	assitido_comp BOOLEAN NOT NULL,
	feedback CHAR(8),
	ultimo_ep_visto CHAR(6),
	no_tempo NUMERIC(4),
	relevancia NUMERIC(100),
PRIMARY KEY(email_conta, perfil, conteudo_id),
FOREIGN KEY(email_conta, perfil) REFERENCES PERFIL(email_conta, nome) ON DELETE CASCADE,
FOREIGN KEY(conteudo_id) REFERENCES CONTEUDO(id) ON DELETE CASCADE);
	
	
INSERT INTO REGIAO VALUES ('Brazil');
INSERT INTO REGIAO VALUES ('India');
INSERT INTO REGIAO VALUES ('Japan');
INSERT INTO REGIAO VALUES ('UK');

INSERT INTO CONTA VALUES('rogerinho@videogames.com', 00, 0, 12345678910, 'ROGERIO V JOGOS', 1337, 1337, '5/13/2013', '9123dcbb0b42652b0e105956c68d3ca2ff34584f324fa41a29aedd32b883e131');
INSERT INTO CONTA VALUES('pessoa@provedor.com', 01, 1, 31234284901, 'PESSOA D SILVA', 123123123, 232, '3/2/1999', '9AD46806888CEB90824DDC36AFC7D4448B4252123491AB8DE16A3A117F303191');
INSERT INTO CONTA VALUES('babyjones@bol.com.br', 01, 2, 11111111111, 'BEBE JONAS', 123124523, 123, '2/4/2050', '56CC8917D573A6E3530B8C0F7E1CD91131679BC9988A05BBE3301ADDB3B8B9E9');
INSERT INTO CONTA VALUES('denishotmail@hotmail.com', 00, 1, 22222222222, 'DENIS H EMAIL', 190580981, 998, '8/12/2024', '629F700087CEC1A358BEE948511789C3AA491AD26EFF7963A576F086AEB360F8');

INSERT INTO GENERO VALUES ('Terror');
INSERT INTO GENERO VALUES ('Comedia');
INSERT INTO GENERO VALUES ('Drama');
INSERT INTO GENERO VALUES ('Comedia Romantica');
INSERT INTO GENERO VALUES ('Suspense');
INSERT INTO GENERO VALUES ('Horror Existencial');

INSERT INTO PERFIL VALUES('rogerinho@videogames.com', 'Roger', '001.jpg', 'UK');
INSERT INTO PERFIL VALUES('rogerinho@videogames.com', 'Roger Infantil', '002.jpg', 'UK');
INSERT INTO PERFIL VALUES('rogerinho@videogames.com', 'ROGER TRISTE', '003.jpg', 'UK');
INSERT INTO PERFIL VALUES('babyjones@bol.com.br', 'Jonas', '004.jpg', 'Brazil');
INSERT INTO PERFIL VALUES('babyjones@bol.com.br', 'Bebe do Jonas', '005.jpg', 'Brazil');
INSERT INTO PERFIL VALUES('pessoa@provedor.com', 'Pessoa Generica', '006.jpg', 'India');
INSERT INTO PERFIL VALUES('denishotmail@hotmail.com', 'DENIS', '007.jpg', 'Japan');

SELECT * FROM REGIAO;
SELECT * FROM CONTA;
SELECT * FROM PERFIL;
SELECT * FROM GENERO;
SELECT * FROM PERFIL_PREFERE;
SELECT * FROM DIRETOR;
SELECT * FROM ATOR;
SELECT * FROM CONTEUDO;
SELECT * FROM AUDIO_LEGENDA;
SELECT * FROM SERIES;
SELECT * FROM TEMPORADAS;
SELECT * FROM EPISODIOS;
SELECT * FROM LEGENDA_AUDIO_EPISODIOS;
SELECT * FROM FILMES;
SELECT * FROM LEGENDA_AUDIO_FILMES;
SELECT * FROM LISTA_PERFIL;
SELECT * FROM MOTIVO_RECOMENDACAO;
SELECT * FROM RECOMENDACOES_PERFIL;
SELECT * FROM DISPONIVEL_PARA;
SELECT * FROM ESTRELANDO;
SELECT * FROM DO_GENERO;
SELECT * FROM DIRIGIDO_POR;
SELECT * FROM ASSISTIR;


